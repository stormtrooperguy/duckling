ESP32 DROID CONTROL SYSTEM - WIRING DIAGRAM
============================================

COMPLETE SYSTEM OVERVIEW
=========================

                               18V BATTERY
                                    │
                        ┌───────────┴────────────┐
                        │                        │
                   BUCK 5V                   BUCK 8V
                        │                        │
          ┌─────────────┼─────────────┐          │
          │             │             │          │
       ┌──┴───┐     ┌──┴──┐      ┌───┴────┐ ┌───┴────┐
       │ LED  │     │ DF  │      │ ESP32  │ │MAESTRO │
       │STRIP │     │PLAYER│     │ BOARD  │ │ SERVO  │
       └──┬───┘     └──┬──┘      └───┬────┘ │ CTRL   │
          │            │              │      └───┬────┘
          │            │              │          │
          │            │         ┌────┴────┐     │
          │            │         │ GPIO 5  │     │
          │            │         │ GPIO 9  │     │
          │            │         │ GPIO 10 │     │
          │            │         │ GPIO 16 │     │
          │            │         │ GPIO 17 │     │
          │            │         └────┬────┘     │
          │            │              │          │
          └────────────┴──────────────┴──────────┘
                       COMMON GROUND
              (All grounds connected including battery negative)


DETAILED COMPONENT CONNECTIONS
================================

1. LED STRIP (WS2812B - 3 LEDs)
   ===============================
   
   ┌──────────────┐
   │  LED STRIP   │
   │  (3x LEDs)   │
   └──┬───┬───┬───┘
      │   │   │
   DIN│ 5V│ GND
      │   │   │
      │   │   │        ┌─────────────────┐
      │   │   └────────┤ GND             │
      │   └────────────┤ 5V (or 3.3V)    │
      └────────────────┤ GPIO 5 (DATA)   │  ESP32
                       └─────────────────┘

   Notes:
   - WS2812B can run on 3.3V or 5V
   - Add 470Ω resistor on data line if using 5V LEDs with 3.3V logic
   - Add 1000µF capacitor across 5V/GND for power stability


2. MAESTRO SERVO CONTROLLER (Optional - Serial1)
   ================================================
   
   ┌────────────────────┐
   │  POLOLU MAESTRO    │
   │  MINI MAESTRO      │
   │                    │
   │  [Servo Channels]  │
   └─┬────┬───┬─────────┘
     │    │   │
    RX   TX  GND
     │    │   │
     │    │   │          ┌─────────────────┐
     │    │   └──────────┤ GND             │
     │    └──────────────┤ GPIO 16 (RX1)   │  ESP32
     └───────────────────┤ GPIO 17 (TX1)   │  Serial1
                         └─────────────────┘

   Notes:
   - Maestro must be powered separately (5-6V for servos)
   - Connect servo power supply to Maestro, NOT ESP32
   - Common ground between ESP32 and Maestro required
   - TX from ESP32 → RX on Maestro
   - RX from ESP32 ← TX from Maestro
   - Baud rate: 9600


3. DFPLAYER MINI MP3 MODULE (Optional - Serial2)
   ================================================
   
   ┌────────────────────┐
   │   DFPLAYER MINI    │
   │                    │
   │   [SD CARD SLOT]   │
   │                    │
   └─┬──┬──┬────┬───┬───┘
     │  │  │    │   │
    RX TX GND  VCC SPK+ SPK-
     │  │  │    │   │   │
     │  │  │    │   │   └────┐
     │  │  │    │   └───┐    │    ┌──────────┐
     │  │  │    │       └────┼────┤ SPEAKER  │
     │  │  │    │            └────┤  (8Ω)    │
     │  │  │    │                 └──────────┘
     │  │  │    │
   ┌─┴──┴──┴────┴────┐
   │ 1kΩ             │
   ├──┐              │
   │  │              │        ┌─────────────────┐
   │  │              └────────┤ 5V              │
   │  │                       │                 │
   │  │        ┌──────────────┤ GND             │  ESP32
   │  └────────┤              │                 │  Serial2
   │           │   ┌──────────┤ GPIO 9 (RX2)    │
   └───────────┼───┤          │                 │
               │   └──────────┤ GPIO 10 (TX2)   │
               │              └─────────────────┘
            IMPORTANT!
      1kΩ resistor between
      ESP32 TX and DFPlayer RX

   Notes:
   - DFPlayer requires 3.2V-5V power (use 5V from ESP32)
   - 1kΩ resistor REQUIRED on RX line (level shifting protection)
   - No resistor needed on TX line
   - SD card must be FAT32 formatted
   - Speaker: 8Ω recommended (3-5W)
   - Baud rate: 9600


PIN ASSIGNMENT TABLE
====================

ESP32 GPIO    | Component         | Signal      | Notes
--------------|-------------------|-------------|---------------------------
GPIO 5        | LED Strip         | Data In     | WS2812B data line
GPIO 9        | DFPlayer Mini     | RX (ESP)    | Serial2 - from DFPlayer TX
GPIO 10       | DFPlayer Mini     | TX (ESP)    | Serial2 - to DFPlayer RX (via 1kΩ)
GPIO 16       | Maestro           | RX (ESP)    | Serial1 - from Maestro TX
GPIO 17       | Maestro           | TX (ESP)    | Serial1 - to Maestro RX
GND           | All Components    | Ground      | Common ground required
5V            | LED Strip, DFP    | Power       | From 5V buck converter
8V            | Maestro           | Power       | From 8V buck converter


POWER DISTRIBUTION (PRODUCTION SYSTEM)
========================================

System uses 18V battery with two buck converters:

                           18V BATTERY
                                │
                    ┌───────────┴────────────┐
                    │                        │
         ┌──────────┴────────┐    ┌──────────┴────────┐
         │  BUCK CONVERTER   │    │  BUCK CONVERTER   │
         │   18V → 5V        │    │   18V → 8V        │
         │   (2A-3A)         │    │   (3A-5A)         │
         └──────────┬────────┘    └──────────┬────────┘
                    │                        │
            5V RAIL │                8V RAIL │
                    │                        │
         ┌──────────┼──────────┐             │
         │          │          │             │
         │          │          │             │
    ┌────┴─────┐ ┌─┴────┐ ┌───┴──────┐ ┌────┴─────┐
    │  ESP32   │ │ LED  │ │ DFPlayer │ │ MAESTRO  │
    │  Board   │ │Strip │ │   Mini   │ │  Servo   │
    └────┬─────┘ └─┬────┘ └────┬─────┘ └────┬─────┘
         │         │           │            │
         └─────────┴───────────┴────────────┘
                   COMMON GROUND
        (Connect all grounds together including battery negative!)

Power Budget:
  5V Rail: ESP32 (500mA) + LEDs (180mA) + DFPlayer (50mA) = ~750mA
  8V Rail: Depends on servos (typically 3-5A for multiple servos)


TESTING POWER SETUP (USB ONLY - NO SERVOS)
============================================

For initial testing with USB power (LEDs and web interface only):

                    USB Cable
                        │
                   ┌────┴─────┐
                   │  ESP32   │
                   │  Board   │
                   └────┬─────┘
                        │ 5V Pin
              ┌─────────┼─────────┐
              │                   │
         ┌────┴─────┐        ┌────┴──────┐
         │   LED    │        │ DFPlayer  │
         │  Strip   │        │   Mini    │
         └──────────┘        └───────────┘

Notes for USB testing:
- Set MAESTRO_ENABLED false in code
- Connect LED strip to ESP32 5V pin (NOT VIN)
- USB can provide ~500mA - sufficient for 3 LEDs + DFPlayer
- DO NOT connect servos when using USB power!


MINIMAL WIRING (LED-ONLY CONFIGURATION)
========================================

If you want to test with LEDs only (no Maestro, no DFPlayer):

1. Set in code: #define MAESTRO_ENABLED false
2. Don't connect DFPlayer (will auto-detect absence)

Simple wiring:
                         ┌─────────────┐
        LED Strip DIN────┤ GPIO 5      │
        LED Strip 5V ────┤ 5V          │  ESP32
        LED Strip GND────┤ GND         │
                         └─────────────┘


STEP-BY-STEP WIRING CHECKLIST
==============================

PRODUCTION SYSTEM (with 18V Battery):

□ Step 0: Setup power system
  - Connect 18V battery to both buck converter inputs
  - Configure first buck converter for 5V output (verify with multimeter)
  - Configure second buck converter for 8V output (verify with multimeter)
  - Connect battery negative to common ground rail

□ Step 1: Connect all ground connections first
  - Battery negative (GND) to ground rail
  - Both buck converter grounds to ground rail
  - ESP32 GND to ground rail
  - LED Strip GND to ground rail
  - DFPlayer GND to ground rail (if using)
  - Maestro GND to ground rail (if using)

□ Step 2: Connect power rails
  - 5V buck converter output to 5V distribution rail
  - 8V buck converter output to Maestro power input
  - ESP32 5V pin to 5V rail
  - LED Strip VCC to 5V rail
  - DFPlayer VCC to 5V rail (if using)

□ Step 3: Connect LED data
  - LED Strip DIN to ESP32 GPIO 5

□ Step 4: Connect DFPlayer (if using)
  - ESP32 GPIO 10 → 1kΩ resistor → DFPlayer RX
  - ESP32 GPIO 9 → DFPlayer TX (direct)
  - DFPlayer SPK+ and SPK- to speaker

□ Step 5: Connect Maestro (if using)
  - ESP32 GPIO 17 → Maestro RX
  - ESP32 GPIO 16 → Maestro TX

□ Step 6: Double-check all connections
  - Verify no short circuits
  - Confirm polarity on power connections
  - Ensure 1kΩ resistor on DFPlayer RX

□ Step 7: Test
  - Upload code
  - Open Serial Monitor (115200 baud)
  - Verify initialization messages


BUCK CONVERTER RECOMMENDATIONS
================================

For 5V Rail (ESP32, LEDs, DFPlayer):
  Input: 18V DC
  Output: 5V DC regulated
  Current Rating: 2A minimum (3A recommended)
  Features: Adjustable output, overcurrent protection, heat sink
  Example: LM2596 based modules, XL4015 modules

For 8V Rail (Maestro Servos):
  Input: 18V DC
  Output: 8V DC regulated
  Current Rating: 3-5A minimum (depends on servos)
  Features: High current capability, adjustable output, thermal protection
  Example: LM2596 (for lighter servo loads), XL4016 (for heavy loads)

Important:
  - Verify output voltage with multimeter BEFORE connecting components
  - Buck converters generate heat - ensure adequate cooling/heat sinking
  - Add fuses: 2A on 5V output, appropriate rating on 8V output
  - Use thick wire (18-20 AWG) for battery and high-current connections
  - Mount converters securely with good ventilation


BATTERY SAFETY
===============

18V Battery Considerations:
  - Use appropriate battery type (LiPo 5S, Li-ion pack, etc.)
  - Ensure battery has proper protection circuit (BMS)
  - Check battery capacity matches current draw
  - Add master power switch for easy shutdown
  - Use appropriate connectors (XT60, Deans, etc.)
  - Never short battery terminals
  - Monitor battery voltage during operation
  - Disconnect battery when not in use

Suggested Battery Capacity:
  - Minimum: 2000mAh (for short operation)
  - Recommended: 3000-5000mAh (for extended operation)
  - Calculate runtime: Capacity (mAh) / Total Current Draw (mA)


COMMON MISTAKES TO AVOID
=========================

Power Related:
❌ Not connecting common ground (battery negative must connect to all grounds)
❌ Buck converter output voltage not verified before connecting components
❌ Insufficient current rating on buck converters
❌ No fuses on power rails
❌ Battery polarity reversed
❌ Powering servos from ESP32 5V pin (will cause brownout/damage)

Wiring Related:
❌ Forgetting 1kΩ resistor on DFPlayer RX line
❌ Swapping TX/RX connections (remember: TX → RX, RX → TX)
❌ Wrong baud rate settings (should be 9600 for both Maestro and DFPlayer)

Data Related:
❌ SD card not FAT32 formatted
❌ MP3 files not named correctly (should be 0001.mp3, 0002.mp3, etc.)
❌ MAESTRO_ENABLED set to false when servos are connected


TROUBLESHOOTING BY LED BEHAVIOR
================================

LEDs don't light:
- Check GPIO 5 connection
- Verify LED strip has power
- Check LED_PIN setting in code
- Try different COLOR_ORDER setting

LEDs wrong colors:
- Try COLOR_ORDER: RGB, GRB, or BRG
- Check voltage (WS2812B works at 3.3V or 5V)

LEDs flicker:
- Add capacitor (1000µF) across power lines
- Check power supply capacity
- Add resistor (470Ω) on data line


For more information, see README.md

